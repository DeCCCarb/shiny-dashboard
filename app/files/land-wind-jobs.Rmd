---
title: "Land Based Wind Job Impacts"
output:
  pdf_document:
    latex_engine: xelatex
    keep_tex: true
mainfont: "Avenir"
fontsize: 11pt
geometry: margin=.5in
---

```{r logo, out.width="3.7in", echo=FALSE}
knitr::include_graphics(here("app", "www", "the2035initiative-logo.png"))
knitr::include_graphics(here("app", "www", "communitylabor-logo.png"))
```



```{r}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.align="center")
library(glue)
library(usdata)
library(tmap)
library(tigris)
library(ggplot2)
library(showtext)

font_add_google("Commissioner")

showtext_auto()


first_year <-input$input_lw_years[1]
final_year <-input$input_lw_years[2]
final_cap <- input$final_gw_land_input
county <- input$county_input


# Calculate jobs by county from user input
        land_wind_om_sb <- calculate_land_wind_om_jobs(
            county = "Santa Barbara",
            start_year = input$input_lw_years[1],
            end_year = input$input_lw_years[2],
            initial_capacity = input$initial_gw_lw_input,
            final_capacity = input$final_gw_land_input,
            direct_jobs = 14,
            indirect_jobs = 23,
            induced_jobs = 8
        )
        
        land_wind_const_sb <- calculate_land_wind_construction_jobs(
            county = "Santa Barbara",
            start_year = input$input_lw_years[1],
            end_year = input$input_lw_years[2],
            initial_capacity = input$initial_gw_lw_input,
            final_capacity = input$final_gw_land_input,
            direct_jobs = 139,
            indirect_jobs = 354,
            induced_jobs = 139
        )
        
        land_wind_om_slo <- calculate_land_wind_om_jobs(
            county = "San Luis Obispo",
            start_year = input$input_lw_years[1],
            end_year = input$input_lw_years[2],
            initial_capacity = input$initial_gw_lw_input,
            final_capacity = input$final_gw_land_input,
            direct_jobs = 14,
            indirect_jobs = 21,
            induced_jobs = 7
        )
        
        land_wind_const_slo <- calculate_land_wind_construction_jobs(
            county = "San Luis Obispo",
            start_year = input$input_lw_years[1],
            end_year = input$input_lw_years[2],
            initial_capacity = input$initial_gw_lw_input,
            final_capacity = input$final_gw_land_input,
            direct_jobs = 25,
            indirect_jobs = 207,
            induced_jobs = 113
        )
        
        land_wind_om_v <- calculate_land_wind_om_jobs(
            county = "Ventura",
            start_year = input$input_lw_years[1],
            end_year = input$input_lw_years[2],
            initial_capacity = input$initial_gw_lw_input,
            final_capacity = input$final_gw_land_input,
            direct_jobs = 14,
            indirect_jobs = 24,
            induced_jobs = 8
        )
        
        land_wind_const_v <- calculate_land_wind_construction_jobs(
            county = "Ventura",
            start_year = input$input_lw_years[1],
            end_year = input$input_lw_years[2],
            initial_capacity = input$initial_gw_lw_input,
            final_capacity = input$final_gw_land_input,
            direct_jobs = 140,
            indirect_jobs = 345,
            induced_jobs = 139
        )
        
        # Create joined dataframe
        lw_all <- rbind(land_wind_const_sb, land_wind_om_sb,
                        land_wind_const_slo, land_wind_om_slo,
                        land_wind_const_v, land_wind_om_v) |>
            filter(type %in% input$lw_job_type_input) |> # Filter to inputted job type
            filter(county %in% input$lw_counties_input)
        
        ##### LW Jobs Plot #####
        lw_plot <- ggplot(lw_all,
                          aes(
                              x = as.factor(year),
                              y = round(n_jobs, 0),
                              group = occupation
                          )) +
            geom_col(aes(fill = occupation, text = purrr::map(
                paste0(occupation, " jobs: ", scales::comma(round(n_jobs, 0))), HTML
            ))) +
            scale_fill_manual(
                labels = c("Construction Jobs", "Operations & Maintenance Jobs"),
                values = c("#3A8398", "#A3BDBE")
            ) +
            scale_y_continuous(labels = scales::comma) +
            scale_x_discrete(breaks = scales::breaks_pretty(n = 5)) +
            labs(
                title = glue::glue(
                    "Projected {input$lw_job_type_input} jobs in {input$lw_counties_input} County \nfrom Land Based Wind development"
                ),
                y = "FTE Jobs"
            ) +
            theme_minimal() +
            theme(
                # Axes
                axis.title.x = element_blank(),
                axis.title.y = element_text(margin = margin(10, 10, 10, 10)),
                
                # Legend
                legend.title = element_blank(),
                legend.position = "bottom",
                text = element_text(family = 'Commissioner')
                
            )
        
lw_plot
```


```{r}
lw_cap <- calculate_land_wind_om_jobs(
            county = input$lw_counties_input,
            start_year = input$input_lw_years[1],
            end_year = input$input_lw_years[2],
            initial_capacity = input$initial_gw_lw_input,
            final_capacity = input$final_gw_land_input,
            direct_jobs = 127,
            indirect_jobs = 126,
            induced_jobs = 131
        )
        
        
        # Generate capacity plot based on user selection
        lw_cap_plot <- ggplot() +
            geom_point(
                data = lw_cap,
                aes(x = as.factor(year), 
                    y = total_capacity_gw,
                    text = purrr::map(
                        paste0("Capacity: ", round(total_capacity_gw, 2), " GW"), HTML
                    )),
                color = "#3A8398"
            ) +
            scale_x_discrete(breaks = scales::breaks_pretty(n = 4)) +
            scale_y_continuous(breaks = scales::breaks_pretty(n = 4)) +
            labs(y = "Capacity (GW)", title = "Annual Online Capacity (GW)") +
            theme_minimal() +
            theme(axis.title.x = element_blank(),
                  text = element_text(family = 'Commissioner'))
```




